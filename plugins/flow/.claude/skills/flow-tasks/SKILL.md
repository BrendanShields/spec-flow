---
name: flow:tasks
description: Break down plan into executable tasks with dependencies. Use when: 1) Technical plan complete and ready for implementation, 2) Need structured task list with priorities, 3) Identifying parallel work opportunities, 4) Creating JIRA subtasks. Generates tasks.md with T### IDs and [P] parallelization markers.
allowed-tools: Read, Write, Edit, Bash
---

# Flow Tasks: User Story-Based Task Generation

Break down implementation into executable, parallel-optimized tasks organized by user story.

## When to Use

- After `flow:plan` creates the technical design
- Ready to create detailed implementation breakdown
- Need parallel execution strategy

## What This Skill Does

1. **Loads** spec.md and plan.md
2. **Extracts** user stories with priorities (P1, P2, P3)
3. **Maps** components to user stories
4. **Generates** tasks.md with:
   - Phase 1: Setup (project initialization)
   - Phase 2: Foundation (blocking prerequisites)
   - Phase 3+: One phase per user story
   - Final Phase: Polish & cross-cutting
5. **Marks** parallelizable tasks with `[P]`
6. **Creates** dependency graph

## Task Format

```
- [ ] T001 [P] [US1] Description with absolute file path
```

Components:
- `T###`: Sequential task ID
- `[P]`: Parallelizable marker (optional)
- `[US#]`: User story label
- Absolute file path required

## Organization Strategy

**By User Story**:
- Each P1, P2, P3 story gets its own phase
- All related work grouped together
- Independently testable increments
- Can ship stories separately

## Example Output

```markdown
## Phase 3: User Story 1 - User Authentication (P1)

**Goal**: Users can register and log in
**Independent Test**: Create account → Login → See dashboard

### Tasks
- [ ] T010 [P] [US1] Create User model in src/models/user.py
- [ ] T011 [P] [US1] Create Auth service in src/services/auth.py
- [ ] T012 [US1] Implement login endpoint in src/api/auth.py
- [ ] T013 [US1] Add authentication middleware

### Parallel Opportunities
Tasks T010, T011 can run concurrently (different files)
```

## Configuration

```json
{
  "workflow": {
    "testsRequired": false  // Generate test tasks
  }
}
```

## MCP Integration (JIRA Subtasks)

If `FLOW_ATLASSIAN_SYNC=enabled` in CLAUDE.md, automatically creates JIRA subtasks from tasks.md:

### JIRA Subtask Creation

**After tasks.md generation**:
1. Read spec.md to get JIRA story IDs (created by `flow:specify`)
2. Parse tasks.md to extract all tasks
3. For each task marked with `[US#]`:
   - Match to parent JIRA story via user story number
   - Create JIRA subtask under parent story
   - Store JIRA subtask ID in tasks.md as comment

```javascript
// Parse task line
const task = "- [ ] T012 [P] [US1] Create User model in src/models/user.py";
const { id, parallel, userStory, description, filePath } = parseTask(task);

// Get parent JIRA story
const parentStory = jiraStories[userStory]; // e.g., "PROJ-123"

// Create subtask
const subtask = await mcp.jira.createIssue({
  projectKey: config.FLOW_JIRA_PROJECT_KEY,
  issueType: 'Sub-task',
  parent: parentStory,
  summary: `${id}: ${description}`,
  description: `
    **File**: ${filePath}
    **Parallel**: ${parallel ? 'Yes' : 'No'}
    **User Story**: ${userStory}

    Generated by Flow from tasks.md
  `,
  labels: ['flow-task', `task-${id}`]
});
```

4. Update tasks.md with JIRA IDs:
```markdown
- [ ] T012 [P] [US1] Create User model in src/models/user.py
<!-- JIRA: PROJ-125 -->
```

### Task Grouping in JIRA

**User Story Organization**:
- Epic (feature level)
  - Story 1 (US1)
    - Subtask T010
    - Subtask T011
    - Subtask T012
  - Story 2 (US2)
    - Subtask T020
    - Subtask T021

### Benefits

- **Sprint Planning**: Drag JIRA subtasks into sprints
- **Team Visibility**: Everyone sees task status in JIRA
- **Time Tracking**: Log time against subtasks
- **Dependencies**: JIRA shows blocking relationships
- **Burndown**: Accurate sprint burndown charts

### Parallel Task Marking

Tasks marked with `[P]` get JIRA label `parallel-ok`:
- Helps team identify independent work
- Multiple developers can work simultaneously
- Sprint planning optimizes for parallel execution

## Related Skills

- **flow:plan**: Generate technical plan (run first)
- **flow:implement**: Execute tasks (run after)
- **flow:analyze**: Validate task completeness
