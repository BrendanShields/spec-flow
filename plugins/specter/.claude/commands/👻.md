# Specter - Unified Hub Command

The single entry point for all Specter workflow operations. Intelligently routes to the appropriate skill based on context and arguments.

## Usage

```bash
/👻                           # Context-aware: shows help or continues workflow
/👻 init                      # Initialize Specter in project
/👻 "Feature description"     # Create specification (auto-detects free text)
/👻 plan                      # Create technical plan
/👻 tasks                     # Break down into tasks
/👻 implement                 # Execute implementation
/👻 --help                    # Show this help
/👻 --interactive             # Interactive menu mode
```

## Smart Routing

The `/👻` command intelligently routes based on:
1. **Explicit subcommands** - Direct routing (e.g., `/👻 init`)
2. **Free text** - Auto-detects specification text
3. **Current context** - Continues workflow from current phase
4. **No arguments** - Shows context-aware help

## Quick Examples

```bash
# Initialize new project
/👻 init

# Create specification (both work the same)
/👻 "Add user authentication with OAuth2"
/👻 specify "Add user authentication with OAuth2"

# Continue workflow (context-aware)
/👻          # In spec phase → creates plan
/👻          # In plan phase → creates tasks
/👻          # In tasks phase → begins implementation

# Explicit workflow control
/👻 plan
/👻 tasks
/👻 implement

# Team collaboration
/👻 team                      # Show team status
/👻 assign @alice T001        # Assign task
/👻 master-spec               # Generate master specification

# Utilities
/👻 status
/👻 validate
/👻 help
```

## Command Router

When you invoke `/👻`, it:

1. **Loads minimal context** (only ~500 tokens)
2. **Detects your intent** from arguments and current phase
3. **Routes to appropriate skill** with lazy loading
4. **Executes efficiently** with progressive disclosure

## Interactive Mode

For users unfamiliar with commands:

```bash
/👻 --interactive
```

Shows a menu based on your current phase:
```
📊 Specter Workflow - Current Phase: Specification
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

What would you like to do?

1. Continue to planning phase
2. Update specification
3. Clarify requirements
4. Check status
5. View team dashboard
6. Exit

Choose an option (1-6):
```

## Progressive Help

Get help tailored to your current phase:

```bash
/👻 --help
```

**In specification phase:**
```
You're in the SPECIFICATION phase.

Next steps:
1. /👻 plan - Create technical plan
2. /👻 clarify - Resolve ambiguities
3. /👻 update "changes" - Modify spec

Current feature: 002-specter-consolidation-v3
Progress: 50% (spec, plan, tasks complete)
```

**In implementation phase:**
```
You're in the IMPLEMENTATION phase.

Next steps:
1. /👻 implement - Continue implementation
2. /👻 status - Check task progress
3. /👻 team - View team assignments

Current feature: 002-specter-consolidation-v3
Tasks: 15/53 complete (28%)
```

## Backward Compatibility

All old commands still work (with deprecation warnings):

```bash
/👻 init        # New way
/specter-init   # Old way (shows deprecation warning)
```

Old commands are wrappers that call `/👻` internally. They will be removed in v4.0 (Jan 2026).

## Token Efficiency

The hub command uses **lazy loading** to minimize token usage:

- **Always loaded**: Router + context detection (~500 tokens)
- **On demand**: Skill core when invoked (~1,750 tokens)
- **Progressive**: Examples/reference only with flags (~15,000 tokens)

**Total**: ~2,250 tokens per invocation (84% reduction vs v2.1)

## Examples by Use Case

### Starting Fresh
```bash
cd my-project
/👻 init
/👻 "Add user authentication system"
/👻 plan
/👻 tasks
/👻 implement
```

### Team Collaboration
```bash
# Alice locks feature
/👻 "Add payment integration"

# Bob tries to work on it
/👻 "Add payment integration"
# ❌ Feature locked by @alice

# Alice assigns tasks
/👻 assign @bob T001 T002

# Bob checks assignments
/👻 team
```

### Continuing Work
```bash
# Check where you left off
/👻 status

# Continue from current phase
/👻

# Or jump to specific phase
/👻 implement --continue
```

## Advanced Features

### Task Assignment
```bash
/👻 assign @username T001           # Assign single task
/👻 assign @username T001-T005      # Assign range
/👻 unassign T001                   # Unassign task
```

### Feature Locking
```bash
/👻 lock 002                        # Lock feature for yourself
/👻 unlock 002                      # Release lock
/👻 force-unlock 002                # Admin override
```

### Master Spec
```bash
/👻 master-spec                     # Generate consolidated documentation
/👻 master-spec --html              # Generate HTML version
```

### Metrics
```bash
/👻 metrics                         # Show development metrics
/👻 metrics --export=csv            # Export to CSV
```

## Skill Mapping

| Subcommand | Skill | Description |
|------------|-------|-------------|
| init | specter-init | Initialize Specter |
| (free text) | specter-specify | Create specification |
| clarify | specter-specify | Resolve ambiguities |
| plan | specter-plan | Technical design |
| tasks | specter-tasks | Task breakdown |
| implement | specter-implement | Execute tasks |
| update | specter-specify | Update specification |
| analyze | specter-analyze | Validate consistency |
| blueprint | specter-init | Define architecture |
| metrics | specter-metrics | Show metrics |
| team | (hub built-in) | Team dashboard |
| assign | (hub built-in) | Task assignment |
| lock/unlock | (hub built-in) | Feature locking |
| master-spec | (hub built-in) | Master spec generation |

## Shell Completion

Enable tab completion:

### Bash
```bash
source ~/.claude/completion/specter.bash
```

### Zsh
```bash
# Add to ~/.zshrc
fpath=(~/.claude/completion $fpath)
autoload -Uz compinit && compinit
```

Now you can use:
```bash
/👻 <TAB>           # Lists all subcommands
/👻 assign @<TAB>   # Lists team members
```

## Troubleshooting

**Command not found?**
```
Error: /👻 command not found

Solution: The plugin may not be installed correctly.
Run: /plugin install specter@specter-marketplace
```

**Context detection failed?**
```
Error: Cannot determine current phase

Solution: Initialize Specter first:
/👻 init
```

**Feature locked by someone else?**
```
Error: Feature 002 is locked by @alice

Solution: Wait for @alice to finish, or contact them to unlock.
Admin: Use /👻 force-unlock 002
```

## Migration from v2.1

If you're used to the old commands:

| Old Command | New Command |
|-------------|-------------|
| /specter-init | /👻 init |
| /specter-specify "X" | /👻 "X" |
| /specter-plan | /👻 plan |
| /specter-tasks | /👻 tasks |
| /specter-implement | /👻 implement |
| /specter-clarify | /👻 clarify |
| /specter-update "X" | /👻 update "X" |

Old commands still work until v4.0 (Jan 2026).

## Related Commands

- `/status` - Check workflow state
- `/help` - Context-aware help
- `/validate` - Validate consistency

---

**Specter v3.0** - Unified workflow command with intelligent routing and team collaboration.

**Quick start**: `/👻 init` → `/👻 "Your feature"` → `/👻` → `/👻` → Done! 🎉

---

## IMPORTANT: Command Behavior

When this command is executed:

1. **First**, check the current context by reading `.specter-state/current-session.md` and `.specter-memory/WORKFLOW-PROGRESS.md`

2. **Then**, output the current status:
   - Current feature and phase
   - Progress percentage
   - Recent completed tasks
   - Next recommended action

3. **Finally**, use the `AskUserQuestion` tool to ask what they'd like to do next with these options:

   - **If in specification phase completed**: Offer "Create technical plan", "Clarify requirements", "Update specification", "Check detailed status"

   - **If in planning phase completed**: Offer "Break down into tasks", "Update plan", "Check detailed status", "Start different feature"

   - **If in tasks phase completed**: Offer "Begin implementation", "Review tasks", "Update tasks", "Check detailed status"

   - **If in implementation phase**: Offer "Continue implementing", "Check progress", "Switch to different task", "Commit current work"

   - **If uninitialized**: Offer "Initialize Specter", "Learn more about Specter", "See examples"

The AskUserQuestion should have:
- **header**: "Next Action"
- **question**: "What would you like to do next?"
- **multiSelect**: false
- **options**: 3-4 options based on current phase with clear labels and helpful descriptions

After the user answers, execute the chosen action immediately without asking for confirmation again.

<!-- ROUTER EXECUTION -->
```bash
source "$(dirname "${BASH_SOURCE[0]}")/router.sh"
main "$@"
```
